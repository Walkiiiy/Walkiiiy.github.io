# 8.18
- 抛弃调错误sql，直接分析question-schema-正确sql得到solution
- 循环改进思路直到能用思路加question输出正确sql，
- 直接sql2text，正确率88.64% (bird_dev)
# 8.19
- sql转text准确率理论上来讲不应该这么低啊。
- V13
- 直接将prompt改成：“描述sql是怎么执行的？
- 92.4%(bird_dev)
- 是否要再加载原有evidence可以处理的question？
- 提取rule：
  - question澄清
  - question通过solution与schema对应：the A in question means B in table, or in oder to A, we have to do B in table.
  - schema特殊性，如表长度不统一等。用schema-linking 检索相关列的详细信息输入prompt，也就是说不用将原本的schmea输入prompt
- rule不好提取。先搁置
- V14
- 循环对比新旧sql做amend，记录修改，直到输出正确sql
- 修改成功后根据所有amend推测其schema层面的原因（到这一步才加入linked-schema）
- wrong-sql也要记录
8.20
- 实验V14_amends
- question 1273 cost 14 loops
- question 41 cot 15 loops
- question 1274 cost 20 loops and failed
- V14_rule:
  - 提取amends为rule
  - 站在schema和用于question层面将每种错误划分为5种原因：
    - question模糊：question中的keywords和schema metadata不对应，question有多种可能呢的含义
    - 背景知识不足：qustion中含有未知的名词或指标，不知道某项指标如何计算，该领域的指标比较特殊，与通用方法有出入
    - schema 结构问题：由于表之间大小不等，表外键特殊等造成的查询方式错误
    - 返回格式问题：答案本身是对的，但是返回的结果与期望不一致
    - 思路规划问题：整体思路出了问题，与原本的思路不一致
  - plan1  
    - 先输出错误sql（直接用sql记录第一条
    - 基于以上错误原因分别对比错误sql和amends（question和linked-schema一同输入）得到rules，加入rules集，
    - rules集和simple schmea question测试，错误sql
    - 循环执行直到凭借rules输出正确sql
    - rules可以构成document
  - plan2
    - 根据sql记录，有几次sql记录就来几轮rule提取，也就是每一次失败的sql都被拿来分析原因作为rule
    - rule整合测试（没有循环迭代）
- 8.22
  - plan2实现
- 8.23
  - plan2 测试
- 8.24
  - question-amends改进：
    - 先根据正确sql分析原因，循环改进sql，每一轮提取带有sql关键字的amends：
    ```
    "Do select only `T2.Consumption` instead of including `t.CustomerID` in the SELECT list. 
    Do use `INNER JOIN` with explicit `AS` aliases `T1` and `T2` instead of simple `JOIN` without aliases. 
    Do move the `(t.Price / t.Amount) > 29.00` filter directly to the WHERE clause instead of keeping it parenthesized. 
    Do place all WHERE conditions (`T1.Price / T1.Amount > 29.00`, `T1.ProductID = 5`, and `T2.Date = '201208'`) as separate AND conditions instead of grouping the price/amount calculation. The amended query now correctly returns only consumption values for the specified criteria."
    ```
    - 然后再从amends分析提取出rules
  - amends->rules方案1:
    - 利用上一轮sql循环改进amends输出的rules
    - birds_dev 88.64%
  - amends->rules方案2:
    - 根据amends记录，有几次amend就来几轮rule提取，也就是每一次失败的sql都被拿来分析原因作为rule
    - birds_dev 达到93.67%， 作为对比bird自带的decument同样条件下正确率在54.82%
  - 方案2输出的rules作为document比较可行：
    ```
    "1) When the question asks for consumption status: output only T2.Consumption column.\n
    2) When joining transactions_1k and yearmonth tables: use inner join where T1.CustomerID = T2.CustomerID with aliases T1 for transactions_1k and T2 for yearmonth.\n
    3) When filtering for product id No.5: include condition T1.ProductID = 5.\n
    4) When filtering for price per unit greater than 29.00: include condition T1.Price / T1.Amount > 29.00.\n
    5) When filtering for August 2012: include condition T2.Date = '201208'.\n
    6) When combining multiple conditions: use AND to connect all filter conditions (T1.Price / T1.Amount > 29.00, T1.ProductID = 5, and T2.Date = '201208').\nOutput columns (ordered): T2.Consumption"
    ```
- 下周计划
  - 开始用此方案构建大型数据集，需要考虑具体规模
  - 完整的架构和微调方案