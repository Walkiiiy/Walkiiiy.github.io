# 8.25
- assumer-verifier    
    - assumer 先rag doc，查找到相似条目，Imitate assume possibility，
    - verifier 验证actions是否可行，可信
- parser负责彻底解释question，planner负责给出完整执行方案，generator/excutor负责生成代码并执行
- 当parser无法获取用户意图时，调用a-v
- 当planner对执行细节/输出方式有疑惑时，调用a-v
- 训练方法需要文献支持，必须要sft的有a-v和planner
- a-v训练可以用doc数据集直接训练
- planner训练的lable可以考虑逆向数据集结果代码/sql，也可以在数据集合成的测试阶段让LLM生成reason
## 8.26
- spider_dev  no rule 778/1034 0.75ac
- 如果处理spider_train 就是1750左右可用的
- bird_dev with rule about 94%（最低89%）,不带rule的还没跑过，需要跑一遍才知道
- bird_dev no rule 56%
- 也就是至少33%可用，bird_train 9400*0.33大约3100个可用
- 太少了。为了增加数据量，首先进行一轮没有schema输入的纯question输入，极大概率返回错误sql，统一使用该错误sql进行amend
## 8.27
- 强调的点
  - 对于极复杂的sql，传统数据集训练存在上限，且极难突破人工精确度
  - sql风格很大程度决定了输出的形式，对于思路正确输出格式不同的结果，传统方法一律判定为错，rules可以限定sql风格，使输出形式对齐
  - 相同schema的相似问题和会有相似的rule,这一点与ReFSQL等同理
- 设计指标：
  - 可以加入question和不直接相关的rules比例作为指标，比如100个question只用10个rule和100个question用30个rule，达到同样的准确率，前者就比后者好。 
## 8.29
- 在parser阶段，对question目的进行描述，在planner阶段生成自然语言处理步骤
- planner和parser生成时都类似与self-rag（或者任何agentic tools调用），生成特殊token表示需要rules查询，schema扩充查询，bak_knowledge（可以读spider-D参考），db sample（planner only）等tools，特别的在进行rule rag时，根据is-relevant/usable进行打分，生成的内容（parse或者plann）根据is-supported/excecutable进行打分，
- 问题，发到ENLP ICLR之类的论文都没有在agentic tools上下工夫，而是对模型本身的训练过程进行改进
- dive deeper into the models and algorithms
- ReFSQL的问题不仅仅在于真实场景中的前置正确sql难以找到，还在于过于依赖模仿相似的sql，会造成不同有要求的sql难以生成，这点可以结合self-rag的思想改进
- 实际上ReFSQL的监督-非监督方法可以用于训练assumer
-  下一篇读spider-dk
-  spider-dk 人工修改原本的spider-quesiton，比如：“… in the order of birth date.”->“… order of their birth date from old to young.”
-  居然是人工，我们已经提出了基于LLM的方法
## 8.31
- 正在跑wrong SQL->Amends->rules合成document的数据集，大约还有一半。
- 改进方案
  - 原本的方案基于对原始错误的question改进获取amend。用dev集估计，在bird和spider的训练集上一共可以合成约5000条rules，数量不够  
  - 为了生成更多rules，把原本能正确处理的question去掉schema信息再输入，先刻意生成一条wrong-SQL，所有数据统一在wrong-sql基础上迭代，这样所有quesiton都有rules。
- 阅读论文"ReFSQL: A Retrieval-Augmentation Framework for Text-to-SQL Generation"
  - 通过设计一种针对相似sql query的特殊retreieve方法，把相似query加入prompt以增强text2sql
  - 无监督学习和监督学习结合，无监督使用相似和不相似sql example，监督使用传统gold_sql。
  - retreiever和无监督学习可以用在assumer训练
  - 笔记在https://walkiiiy.github.io/2025/08/26/ReFSQL/
- 下周计划
  - 数据集弄完并测试
  - 继续读论文，想具体流程，特别是rules retreieve和assumer的训练