---
title: 经典对称加密算法DES_AES
date: 2025-03-16 09:34:39
tags:
---
# DES

## **主要参数**
- **输入明文块：** 64 位
- **输出密文块：** 64 位
- **密钥长度：** 64 位（其中 8 位用于奇偶校验，实际有效密钥长度为 56 位）
- **加密轮数：** 16 轮
- **加密模式：** 基于 Feistel 结构
- **安全性：** 由于密钥较短（56 位），已被暴力破解（如 EFF 在 1999 年使用专用硬件破解 DES 仅需 22 小时）。

---

## **加密过程**
DES 采用 **Feistel 结构**，核心是**轮函数（F 函数）**，加密过程如下：
![main](/images/DES-main-network.png)

### **（1）初始置换（IP，Initial Permutation）**
- 对输入的 64 位明文进行固定的置换。
- 置换表如下（对 64 位明文重新排列）：
  
  | 58 | 50 | 42 | 34 | 26 | 18 | 10 |  2 |
  |----|----|----|----|----|----|----|----|
  | 60 | 52 | 44 | 36 | 28 | 20 | 12 |  4 |
  | 62 | 54 | 46 | 38 | 30 | 22 | 14 |  6 |
  | 64 | 56 | 48 | 40 | 32 | 24 | 16 |  8 |
  | 57 | 49 | 41 | 33 | 25 | 17 |  9 |  1 |
  | 59 | 51 | 43 | 35 | 27 | 19 | 11 |  3 |
  | 61 | 53 | 45 | 37 | 29 | 21 | 13 |  5 |
  | 63 | 55 | 47 | 39 | 31 | 23 | 15 |  7 |

- **作用**：增加混淆性，但可以直接逆向操作。

### **（2）分组（L0, R0）**
- **IP 置换后**，数据被拆分成左右两个 32 位部分：
  $$
  L_0, R_0
  $$

### **（3）16 轮 Feistel 结构**

**每一轮** $ i $ 进行如下操作：
$$
L_{i+1} = R_i
$$
$$
R_{i+1} = L_i \oplus F(R_i, K_i)
$$
其中：
- $ F(R_i, K_i) $ 是核心轮函数（包含 S-盒）。
- $ K_i $ 是该轮的 48 位子密钥。

**F 函数内部结构**
![feistel](/images/feistel-DES-f-function.png)
1. **扩展置换（E 扩展）**
   - 把 32 位 $ R_i $ 扩展成 48 位，以便与子密钥 $ K_i $ 进行 XOR。
   - 通过 E 扩展表复制部分位（位数增加）：
     $$
     E: \{32\} \to \{48\}
     $$

2. **子密钥 XOR**
   - 48 位扩展数据与 48 位子密钥 $ K_i $ 进行 XOR 操作。

3. **S-盒（Substitution Box）非线性变换**
   - DES 共有 **8 个 S-盒**，每个 S-盒接受 6 位输入(1,6位为行,中间4位为列号)，输出 4 位数据。
   - S-盒提供非线性映射，增强加密强度。
   - 与AES的s盒不同,这里不是一一对应的.

4. **P 置换（Permutation）**
   - S-盒输出的 32 位数据经过 **P 置换** 重新排列，以增加扩散性。

5. **最终输出 F(R, K)**
   - F 函数的输出 32 位，将用于下一轮的异或计算。

### **（4）16 轮后交换（Swap）**
- 经过 16 轮变换后，$ L_{16}, R_{16} $ 交换：
  $$
  \text{Swap}(L_{16}, R_{16})
  $$

### **（5）逆初始置换（IP⁻¹）**
- 最后进行 **IP⁻¹ 逆置换**，还原数据顺序，得到 64 位密文。

---

## **3. DES 密钥生成**
![key-gen](/images/DES-key-schedule.png)
### **（1）密钥置换 PC-1**
- 64 位密钥去掉 8 位奇偶校验位，得到 **56 位密钥**。

### **（2）密钥分割**
- 分割成两个 28 位的部分 $ C_0, D_0 $。

### **（3）16 轮密钥移位**
- 每轮将 $ C_i, D_i $ 左移 1 或 2 位。

### **（4）压缩置换 PC-2**
- 56 位密钥压缩为 **48 位子密钥**，用于 F 函数。

---

## **4. DES 解密过程**
- **解密与加密过程相同**，唯一不同的是**子密钥 $ K_i $ 的顺序反转**。
- 由于 XOR 变换和 Feistel 结构的可逆性，解密可以逐步还原原始明文。

---

## **5. DES 安全性分析**
### **（1）暴力破解**
- DES 仅使用 **56 位密钥**，即 $ 2^{56} $ 种可能性。
- **现代计算机可以在数小时内暴力破解**（1999 年 EFF 组织仅用 22 小时破解 DES）。
- **对策：使用 3DES（Triple DES）** 提高安全性。

### **（2）差分分析（Differential Cryptanalysis）**
- 1990 年被发现，针对 S-盒的设计进行分析，但 **DES S-盒已经优化**，使这种攻击成本较高。

### **（3）线性分析（Linear Cryptanalysis）**
- 1993 年被发现，使用线性逼近方法破解，但 **需要 $ 2^{43} $ 组明密文对**，对实际攻击影响不大。

---
# AES
取代了DES（Data Encryption Standard）成为现代加密的主流标准。AES 由美国国家标准与技术研究院（NIST）于 2001 年发布，广泛应用于数据加密和信息安全领域。AES 采用**分组密码**的方式，对固定长度（**128 位**）的数据块进行加密，并支持 128、192 和 256 位的密钥长度。

---
![AES](/images/AES.png)
## **基本结构**
AES 的加密过程采用 **SPN（Substitution-Permutation Network）结构**，即“**代换-置换**”网络。AES 的核心组成部分包括：
- **字节替换（SubBytes）**
- **行移位（ShiftRows）**
- **列混合（MixColumns）**
- **轮密钥加（AddRoundKey）**
- **密钥扩展（KeyExpansion）**

AES 采用**多轮迭代**的方式进行加密：
- **AES-128** 需要 **10 轮**
- **AES-192** 需要 **12 轮**
- **AES-256** 需要 **14 轮**

---

## **2.加密过程**
AES 的加密过程可以表示为：
1. **密钥扩展（Key Expansion）**
2. **初始轮（Initial Round）**
   - 轮密钥加（AddRoundKey）
3. **主轮（Main Rounds）**
   - 字节替换（SubBytes）
   - 行移位（ShiftRows）
   - 列混合（MixColumns）
   - 轮密钥加（AddRoundKey）
4. **最终轮（Final Round）**
   - 字节替换（SubBytes）
   - 行移位（ShiftRows）
   - 轮密钥加（AddRoundKey）

### **2.1 密钥扩展（Key Expansion）**
AES 的密钥扩展算法会从原始密钥生成多个**轮密钥（Round Key）**，以供每轮加密使用。扩展过程采用**Rijndael 密钥扩展算法**，规定一字32bit,根据密钥长度（128/192/256 位）生成不同数量的子密钥：
- **AES-128** 需要 **44 字轮密钥（4 × (10+1)）**
- **AES-192** 需要 **52 字轮密钥（4 × (12+1)）**
- **AES-256** 需要 **60 字轮密钥（4 × (14+1)）**

扩展步骤：
1. **前 4 个字（128 位）直接来自密钥**
2. **后续密钥** 由前一个密钥组的变换（包括 **轮常量（Rcon）和 S 盒（S-box）替换）** 计算得出

---

### **2.2 初始轮（Initial Round）**
**AddRoundKey（轮密钥加）**
- 将明文的 128 位数据**按列组织成 4×4 的状态矩阵**（State Matrix）
- 用第 0 轮密钥（Round Key）进行**按位异或（XOR）** 操作

公式：
$$
\text{State} = \text{State} \oplus \text{RoundKey}
$$

---

### **2.3 主轮（Main Rounds）**
主轮是 AES 的核心，每轮包括以下四个步骤：

#### **(1) 字节替换（SubBytes）**
- 采用 **S-Box（替换盒）**，对每个字节进行替换（非线性变换）
- S-Box 是基于有限域 GF(2⁸) 的逆元变换和仿射变换构造的
- 目的是**增加数据的混淆性（Confusion）**

#### **(2) 行移位（ShiftRows）**
- 处理 **状态矩阵（State）** 的行：
  - **第 0 行不变**
  - **第 1 行左移 1 字节**
  - **第 2 行左移 2 字节**
  - **第 3 行左移 3 字节**
- 目的是**打乱数据位置，增强扩散性（Diffusion）**

示例：
```
初始状态：
a0 a1 a2 a3
b0 b1 b2 b3
c0 c1 c2 c3
d0 d1 d2 d3

移位后：
a0 a1 a2 a3
b1 b2 b3 b0
c2 c3 c0 c1
d3 d0 d1 d2
```

#### **(3) 列混合（MixColumns）**
- 将 **状态矩阵的每一列** 视为一个 4 维向量，与一个固定的矩阵**相乘（有限域 GF(2⁸) 乘法）**，达到**数据扩散**的目的
- 计算公式：
$$
\begin{bmatrix}
s'_0 \\ s'_1 \\ s'_2 \\ s'_3
\end{bmatrix}
=
\begin{bmatrix}
02 & 03 & 01 & 01 \\
01 & 02 & 03 & 01 \\
01 & 01 & 02 & 03 \\
03 & 01 & 01 & 02
\end{bmatrix}
\cdot
\begin{bmatrix}
s_0 \\ s_1 \\ s_2 \\ s_3
\end{bmatrix}
$$

- **提高扩散性，使明文的每一比特影响多个比特**

#### **(4) 轮密钥加（AddRoundKey）**
- 与对应的 **轮密钥（Round Key）** 进行**按位异或（XOR）**
- 目的是提供 **密钥依赖性（Key Dependency）**

---

### **2.4 最终轮（Final Round）**
最终轮与主轮类似，**但去掉了列混合（MixColumns）**，只执行：
- **字节替换（SubBytes）**
- **行移位（ShiftRows）**
- **轮密钥加（AddRoundKey）**

最终得到 **密文（Ciphertext）**。

---

## **3. AES 加密流程总结**
1. **输入：** 128-bit 明文 + 128/192/256-bit 密钥
2. **密钥扩展：** 生成多个轮密钥
3. **初始轮**
   - 轮密钥加
4. **主轮（重复 9/11/13 轮）**
   - 字节替换
   - 行移位
   - 列混合
   - 轮密钥加
5. **最终轮**
   - 字节替换
   - 行移位
   - 轮密钥加
6. **输出：** 128-bit 密文
**AES具有良好的扩散性和混淆性**
* 混淆指明文和密文之间的关系足够复杂(非线性,通过s盒实现)
* 扩散指打散明文的结构，使明文的小变化能够影响密文的大部分(雪崩效应,列混淆实现)
## **填充**
**常见填充方法PKCS#7**:每个填充字节内均为填充字节的长度,如果明文正好是16字节,就附加一个空的16字节,每个字节值都为16.
##  **分组密码工作模式**
![分组密码工作模式](/images/BlockCipherModesofOperation.svg.png)
#### 电码本ECB
重复信息块会重复出现
#### 密码块链接CBC
随机生成向量IV,与首块异或后和KEY一起AES,结果向后参与异或运算.IV必须保证随机,并且附在密文前面.
#### CTR计数器模式
* 使用12字节的Nonce和4字节计数器组成16字节,和KEY一起进入AES加密后和明文异或.Nonce要求有随机性.
* 不需要填充,可以用流密码的方式应用AES.
## AES-GCM
应用最广泛的对称加密-认证一体化算法(同等的还有ChaCha20Ploy1305)
* 首先使用CTR模式进行AES加密,然后用加密后的Nonce0和每一轮密文进行异或生成认证标签
* Nonce的唯一随机性保证认证标签无法伪造.
* 使用GMAC,即使用伽罗瓦域GF中的算术来计算认证标签.
![AESGCM](/images/AESGCM.png)
# 细节补充:
## **AES 的密钥长度、轮数和派生密钥数量**
AES（高级加密标准）支持 **三种不同的密钥长度**，对应不同的加密轮数和派生密钥数量：

| **AES 密钥长度** | **轮数（Nr）** | **派生的轮密钥数量（Nk, 32 位字）** | **需要派生的总密钥字数（Nb × (Nr+1)）** |
|--------------|------------|----------------|--------------------|
| **AES-128**（16 字节 = 128 位） | 10 轮 | 4（原始密钥）+ 40（扩展）= 44 | 44 个 32 位字（= 176 字节） |
| **AES-192**（24 字节 = 192 位） | 12 轮 | 6（原始密钥）+ 48（扩展）= 52 | 52 个 32 位字（= 208 字节） |
| **AES-256**（32 字节 = 256 位） | 14 轮 | 8（原始密钥）+ 56（扩展）= 60 | 60 个 32 位字（= 240 字节） |

---

## **AES 密钥派生（密钥扩展算法）**
AES 的 **密钥扩展（Key Expansion）** 采用 **Rijndael 密钥扩展算法**，主要用于从输入密钥生成所有的**轮密钥（Round Keys）**，以便在每一轮 AES 变换时使用。

### **1. 主要步骤**
密钥扩展算法主要基于**字（word）**单位进行操作，每个字是 **4 个字节（32 位）**。  

派生过程如下：
1. **将输入密钥作为初始密钥存入数组**。
2. **对剩余的字（Word）进行扩展**：
   - 每 **Nk 个字** 触发特殊变换（RotWord + SubWord + Rcon）。
   - 其余部分根据前一个字进行扩展。
3. **最终生成 Nb × (Nr+1) 个 4 字节的密钥字**，供 AES 各轮使用。

---

### **2. 详细步骤**
设 AES 密钥扩展生成的数组为 $ W[i] $，其中每个 $ W[i] $ 是一个 **4 字节（32 位）** 的字，步骤如下：

#### **（1）初始化**
- 先把原始密钥存入前 **Nk** 个字，即：
  $$
  W[i] = \text{Key}[i], \quad \text{for } 0 \leq i < Nk
  $$
  其中：
  - **Nk** 是密钥长度（128-bit = 4，192-bit = 6，256-bit = 8）。
  - 初始密钥的 **Nk 个字** 直接拷贝到密钥数组。

---

#### **（2）密钥扩展**
**对于 $ i \geq Nk $，计算 $ W[i] $**
$$
W[i] = W[i-Nk] \oplus \text{KeyExpansionFunction}(W[i-1], i)
$$
其中：
- **如果 $ i $ 是 Nk 的整数倍**，则：
  $$
  \text{KeyExpansionFunction}(W[i-1], i) = \text{SubWord}(\text{RotWord}(W[i-1])) \oplus Rcon[i/Nk]
  $$
- **如果是 AES-256 并且 $ i $ 是 4 的倍数（但不是 8 的倍数）**：
  $$
  \text{KeyExpansionFunction}(W[i-1], i) = \text{SubWord}(W[i-1])
  $$
- **否则，直接使用 $ W[i-1] $**：
  $$
  \text{KeyExpansionFunction}(W[i-1], i) = W[i-1]
  $$

---

### **3. 关键操作**
#### **（1）RotWord**
**循环左移 1 字节**（用于增加密钥的扩散性）：
$$
\text{RotWord}([a_0, a_1, a_2, a_3]) = [a_1, a_2, a_3, a_0]
$$
示例：
$$
\text{RotWord}([0x09, 0xCF, 0x4F, 0x3C]) = [0xCF, 0x4F, 0x3C, 0x09]
$$

#### **（2）SubWord**
**对每个字节应用 AES S-盒**（增加非线性）：
$$
\text{SubWord}([b_0, b_1, b_2, b_3]) = [S(b_0), S(b_1), S(b_2), S(b_3)]
$$

示例：
$$
\text{SubWord}([0xCF, 0x4F, 0x3C, 0x09]) = [S(0xCF), S(0x4F), S(0x3C), S(0x09)]
$$

#### **（3）轮常数（Rcon）**
Rcon（Round Constant）是一个 4 字节的数组，仅在 **每 Nk 轮** 进行变换时使用：
$$
Rcon[i] = [2^{(i-1)}, 0x00, 0x00, 0x00] \quad \text{在 GF(2⁸) 上}
$$
示例：
| 轮数 $ i $ | Rcon[i] (十六进制) |
|---------|--------------|
| 1       | 0x01 00 00 00 |
| 2       | 0x02 00 00 00 |
| 3       | 0x04 00 00 00 |
| 4       | 0x08 00 00 00 |
| 5       | 0x10 00 00 00 |
| 6       | 0x20 00 00 00 |
| 7       | 0x40 00 00 00 |
| 8       | 0x80 00 00 00 |
| 9       | 0x1B 00 00 00 |
| 10      | 0x36 00 00 00 |

---

