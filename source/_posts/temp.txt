### **RSA 解密时 \( M \) 是 \( p \) 的倍数的推导总结**
---

#### **问题**
已知：
- RSA 加密：\( C = M^e \mod n \)
- RSA 解密：\( M' = C^d \mod n \)
- \( M \) 是 \( p \) 的倍数，即 \( M = k p \)
- 目标：证明解密后 \( M' = M \)

---

#### **第一步：计算 \( M' \mod p \)**
1. 由于 \( M = k p \)，加密后：
   \[
   C = (k p)^e = k^e p^e \mod n
   \]
2. 取模 \( p \)：
   \[
   C \equiv 0 \pmod{p}
   \]
3. 解密：
   \[
   M' = C^d \equiv 0^d \equiv 0 \pmod{p}
   \]
4. 结论：\( M' \) 仍然是 \( p \) 的倍数。

---

#### **第二步：计算 \( M' \mod q \)**
1. 取模 \( q \)：
   \[
   C \equiv k^e p^e \pmod{q}
   \]
2. 由于 \( p^e \) 指数较大，利用 **费马小定理** 化简：
   \[
   p^{q-1} \equiv 1 \pmod{q}
   \]
   使得：
   \[
   p^e \equiv p^r \pmod{q}, \quad 其中 \quad r = e \mod (q-1)
   \]
3. 进一步解密：
   \[
   M' = C^d \equiv (k^e p^r)^d \equiv k^{e d} p^{r d} \pmod{q}
   \]
4. 由于 \( e d \equiv 1 \pmod{\varphi(n)} \)，所以：
   \[
   p^{e d} \equiv p \pmod{q}
   \]
   以及：
   \[
   k^{e d} \equiv k \pmod{q}
   \]
5. 因此：
   \[
   M' \equiv k p \pmod{q}
   \]

---

#### **第三步：使用中国剩余定理（CRT）合并**
已知：
\[
\begin{cases}
M' \equiv 0 \pmod{p} \\
M' \equiv k p \pmod{q}
\end{cases}
\]
1. 设 \( M' = p x \)，带入第二个方程：
   \[
   p x \equiv k p \pmod{q}
   \]
   两边除以 \( p \)（因 \( p \) 和 \( q \) 互质）：
   \[
   x \equiv k \pmod{q}
   \]
2. 设通解：
   \[
   x = k + m q
   \]
3. 代回 \( M' = p x \)：
   \[
   M' = p (k + m q) = k p + m p q
   \]
   由于 \( m p q \) 是 \( pq \) 的倍数：
   \[
   M' \equiv k p \pmod{pq}
   \]
4. **最终得到：**
   \[
   M' = k p = M
   \]
   **成功恢复明文！**

---

### **总结**
1. **在模 \( p \) 下，解密后 \( M' \equiv 0 \pmod{p} \)。**
2. **在模 \( q \) 下，利用费马小定理化简指数，解密后 \( M' \equiv k p \pmod{q} \)。**
3. **使用中国剩余定理（CRT）合并，得到唯一解 \( M' = M \)。**
4. **证明 RSA 即使在 \( M \) 是 \( p \) 的倍数时，仍能正确解密！**

---

这样就完整推导了 **RSA 解密过程中如何正确恢复明文，即使 \( M \) 是 \( p \) 的倍数！** 🎯

现在你应该清楚了吧？😊