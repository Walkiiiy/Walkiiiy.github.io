---
title: SM2公钥加密
date: 2025-03-08 10:55:08
tags:
---

**本质是基于ECC公钥加密,选取随机数k后发送M+kP,kG,接受方验证M=(M+kP)-d(kG).**
#### **2. SM2加密流程**
SM2公钥加密基于ECC，使用了一种混合加密方式，结合了ECC和对称加密，提高了效率和安全性。它的加密流程如下：

##### **(1) 设定参数**
- 选择一条椭圆曲线 $ E $，并设定有限域 $ F_p $。
- 选择一个基点 $ G $ 和其阶 $ n $。
- 用户生成密钥对：
  - 私钥：$ d $，满足 $ 1 \leq d \leq n-1 $。
  - 公钥：$ P = dG $。

##### **(2) 加密过程**
输入：
- 明文消息 $ M $。
- 接收者的公钥 $ P $。

加密步骤：
1. **随机选取整数 $ k $**，$ 1 \leq k \leq n-1 $。
2. **计算椭圆曲线点** $ C_1 = kG $，$ C_1 $ 也是密文的一部分。
3. **计算共享密钥** $ S = kP $，再从 $ S $ 中提取 $ x_2, y_2 $ 坐标。
4. **使用密钥派生函数（KDF, Key Derivation Function）计算加密密钥**：
   - $ t = KDF(x_2 \| y_2, klen) $，其中 $ klen $ 是明文 $ M $ 的比特长度。
   - 若 $ t = 0 $，则重新选择 $ k $ 并重复步骤。
5. **加密消息**：
   - 计算密文 $ C_2 = M \oplus t $。
6. **计算消息的哈希值**：
   - $ C_3 = Hash(x_2 \| M \| y_2) $。
7. **输出密文** $ C = (C_1, C_2, C_3) $。

##### **(3) 解密过程**
输入：
- 密文 $ C = (C_1, C_2, C_3) $。
- 私钥 $ d $。

解密步骤：
1. **计算共享密钥**：
   - 计算 $ S' = dC_1 $，从中提取 $ x_2, y_2 $。
2. **计算加密密钥**：
   - $ t = KDF(x_2 \| y_2, klen) $。
   - 若 $ t = 0 $，解密失败。
3. **恢复明文**：
   - $ M' = C_2 \oplus t $。
4. **验证哈希值**：
   - 计算 $ Hash(x_2 \| M' \| y_2) $ 并与 $ C_3 $ 进行比较，若不同，则解密失败。
5. **输出明文** $ M' $。

---

#### **3. 安全性分析**
SM2公钥加密的安全性主要基于以下几点：
1. **椭圆曲线离散对数问题（ECDLP）**：求解 $ d $ 使得 $ P = dG $ 在计算上是困难的。
2. **使用随机数 $ k $ 生成共享密钥**，使得相同的明文每次加密得到不同的密文，提高抗攻击能力。
3. **密钥派生函数（KDF）** 防止明文直接暴露在加密过程中，抵御字典攻击。
4. **引入哈希值校验 $ C_3 $**，防止密文被篡改，提高完整性。

---
