---
title: XiYan-SQL
date: 2025-07-15 08:58:52
tags:
---
**文献阅读：微调+few-shot prompting，小参数量的NL2SQL模型**
**from"A PREVIEW OF XIYAN-SQL: A MULTI-GENERATOR ENSEMBLE  FRAMEWORK FOR TEXT-TO-SQL“**
## Overview
- **XiYan uses different NL2SQL datasets for testing, include Bird, Spider, SQL-Eval, NL2GQL. Which proves its robustness.**
- two main methods:
    - prompt engineering: massive parameter LLM(often close sourced), plus most of them using multi-path generation and selecting the best option utilizing self-consistency, resulting in significant inference overheads.
    - SFT: small parameters LLM, supervised fine-tunning.Struggle to perform complex NL2SQL reasoning and transfer to databases within a new domain. 
![XiYan_framework](/images/XiYan_framework.png)
- XiYan uses both:
    - SFT: introduce a two-stage multi-task training approach, which first activates the model’s fundamental SQL generation capabilities, and subsequently transitions to a model with enhanced semantic understanding and diverse stylistic preferences. 
    - prompt engineering: To enhance diversity of generated candidates and capability of generating complex SQL queries, we utilize in-context learning to prompt LLMs.
## M-Schema
M-Schema is a way of describing the data structure of a database. From DDL Schema, MAC-SQL Schema to M-Schema, the descriptions are getting more specific, while all the content are machincally generated(in comparision, in"Automatic Metadata Extraction for Text-to-SQL", the used profiled info, fused with NL description generated by LLM, getting a better score in Bird.)
![XiYan_MSchema](/images/XiYan_MSchema.png)
## Schema Linking
Method similar to **Chase-sql**, use both column retriever and value retriever.
- column retriever is based on the semantic similarity between the keywords and the column descriptions, retrieve the top-k columns for each keyword.
- value retriever employs a two-phase retrieval strategy based on Locality Sensitive Hashing (LSH) and semantic similarity to identify similar values in the database.

**why value retriever?** why not just retrieve the relevant columns and give them to LLM?
thats because column retriever cant handle entities, when questions like "how many golden medals were fetched by China in 2022?", **only by value retriever, the system can link "China" to "Contury" and "2022" to "year".**
## Candidate Generation
```
该系列多尺寸可选（3B–32B），其中最强的是 32B 版本；
在 Bird benchmark 上，32B 版本取得了单模型 69.03% 执行准确率
```
- Fine-tuned SQL Generator
    - Basic-syntax training: teaches the model how to write SQL at a syntactic level
    - Generation-enhance training: input more semantically complex natural language questions
- ICL SQL Generator
    - ICL is actually few-shot prompt, this is to select similar questions with the origin question from datasets as examples in few-shot prompts.
    ```
    All named entities in the question are first identified using NLTK’s tool, 
    then the named entities of the same type are replaced with a special token. 
    For example, "China" and "America" are both identified as countries, so both of them are replaced by "<country>". 
    Other entities, such as enumeration values, are replaced by the column names. 
    This approach avoids focusing too much on entities, while the semantics of entities is preserved. 
    Then we compute embedding of modified questions in the training and test sets, 
    and top-K examples from training sets that closely match the target question are selected.
    ```
- SQL Refiner and Selector
same as CHASE-SQL
## res
![XiYan_res](/images/XiYan_res.png)

