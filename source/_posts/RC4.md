---
title: 流密码算法RC4
date: 2025-03-08 10:10:27
tags:
---
由于其安全性问题，现代应用已逐渐弃用。

---

## **加密流程**
RC4 采用**可变长度密钥**（通常为 40-2048 位），通过生成**伪随机字节流**来与明文进行**异或（XOR）**运算，实现加密和解密。

---

### **（1）密钥调度算法（KSA，Key Scheduling Algorithm）**
密钥调度用于初始化 256 字节的 S-Box（状态数组）**S**。

1. **初始化 S-Box**：
   - 设 S 为一个 256 字节的数组（即 0~255）。
   - 设 K 为密钥的字节数组，长度 **L**（通常 5~32 字节）。

   **初始化 S-Box：**
   $$
   S[i] = i, \quad (0 \leq i \leq 255)
   $$
   
2. **使用密钥打乱 S-Box**：
   - 设一个变量 `j = 0`，对 S 进行 256 次置换：
     $$
     j = (j + S[i] + K[i \mod L]) \mod 256
     $$
     $$
     交换 S[i] \leftrightarrow S[j]
     $$
   - 经过此步骤，S-Box 被密钥扰动，形成一个新的排列。

---

### **（2）伪随机数生成算法（PRGA，Pseudo-Random Generation Algorithm）**
此阶段用于生成伪随机密钥流，与明文 XOR 进行加密/解密。

1. **设 i = 0, j = 0**。
2. **每次加密一个字节**：
   - 递增 i：
     $$
     i = (i + 1) \mod 256
     $$
   - 更新 j：
     $$
     j = (j + S[i]) \mod 256
     $$
   - 交换 `S[i]` 和 `S[j]`：
     $$
     S[i] \leftrightarrow S[j]
     $$
   - 计算密钥流字节：
     $$
     K_{\text{byte}} = S[(S[i] + S[j]) \mod 256]
     $$
   - 明文字节 `P_t` 与 `K_byte` 进行 XOR 计算：
     $$
     C_t = P_t \oplus K_{\text{byte}}
     $$
   - 产生的密文 `C_t` 作为加密后的数据。

**解密过程**与加密相同，只需对密文重新 XOR 相同的密钥流，即可还原明文：
$$
P_t = C_t \oplus K_{\text{byte}}
$$

---

## **安全性**
1. **前 256 个字节的密钥流存在弱点**，攻击者可以分析加密模式进行密钥推测。
2. **WEP 协议中的 RC4 易受密钥重用攻击（如 FMS 攻击）**，导致密钥泄露。
3. **TLS 1.0/1.1 采用 RC4 被发现存在偏差攻击，攻击者可以恢复部分明文**。
